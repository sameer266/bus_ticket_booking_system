{% extends 'components/base.html' %}
{% block title %}Bus & Vehicle List | Sub-Admin Dashboard{% endblock %}
{% block content %}
<div id="sub-admin-page-content" class="bg-light min-vh-100 " style="margin-top:80px;">
    <div class="container-fluid py-4">
        <div class="row justify-content-center">
            <div class="col-xl-11 col-lg-12 col-md-12">
                <!-- Page Header -->
                <div class="d-flex flex-column flex-sm-row align-items-start align-items-sm-center justify-content-between mb-4 gap-3">
                    <div class="d-flex align-items-center gap-3">
                        <!-- Back Button -->
                        <a href="{% url 'transportation_company_list' %}" class="btn sub-admin-btn-back" title="Back to Table">
                            <i class="bi bi-arrow-left"></i>
                        </a>
                        <h1 class="sub-admin-title mb-0">
                            <i class="bi bi-bus-front me-2"></i>Transportation Management
                        </h1>
                    </div>
                    <div class="d-flex flex-wrap gap-2">
                        <span class="sub-admin-stat-badge">
                            <i class="bi bi-bus-front me-1"></i>Total Buses: {{ bus_count }}
                        </span>
                        <span class="sub-admin-stat-badge">
                            <i class="bi bi-calendar-check me-1"></i>Total Schedules: {{ bus_schedule_count }}
                        </span>
                        <span class="sub-admin-stat-badge">
                            <i class="bi bi-truck me-1"></i>Total Vehicles: {{ vehicle_count }}
                        </span>
                    </div>
                </div>

                <!-- Tabs for Buses and Vehicles -->
                <ul class="nav nav-tabs mb-4" id="transportationTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="buses-tab" data-bs-toggle="tab" data-bs-target="#buses" type="button" role="tab" aria-controls="buses" aria-selected="true">
                            <i class="bi bi-bus-front me-1"></i>Buses
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="vehicles-tab" data-bs-toggle="tab" data-bs-target="#vehicles" type="button" role="tab" aria-controls="vehicles" aria-selected="false">
                            <i class="bi bi-truck me-1"></i>Vehicles
                        </button>
                    </li>
                </ul>

                <div class="tab-content" id="transportationTabsContent">
                    <!-- Buses Tab Content -->
                    <div class="tab-pane fade show active" id="buses" role="tabpanel" aria-labelledby="buses-tab">
                        <!-- Bus List Table -->
                        <div class="card sub-admin-card mb-4">
                            <div class="card-header sub-admin-card-header d-flex justify-content-between align-items-center">
                                <h6 class="m-0">
                                    <i class="bi bi-list-ul me-2"></i>All Buses
                                </h6>
                                <div class="input-group input-group-sm w-auto">
                                    <span class="input-group-text bg-light border-end-0"><i class="bi bi-search"></i></span>
                                    <input type="text" class="form-control border-start-0 ps-0" id="searchBus" placeholder="Search buses..." style="max-width: 200px;">
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table sub-admin-table m-0">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Bus Name</th>
                                                <th>Type</th>
                                                <th>Image</th>
                                                <th>Capacity</th>
                                                <th>Driver</th>
                                                <th>Staff</th>

                                              
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for bus in buses %}
                                            <tr class="bus-row">
                                                <td>{{ bus.id }}</td>
                                                <td class="fw-medium">{{ bus.bus_number }}</td>
                                                <td>{{ bus.bus_type }}</td>
                                                <td>
                                                    {% if bus.image %}
                                                        <img src="{{ bus.image.url }}" alt="Bus Image" class="img-fluid" style="max-width: 50px; max-height: 50px;">
                                                    {% else %}
                                                        <span class="sub-admin-badge-none">No Image</span>
                                                    {% endif %}
                                                </td>
                                                <td>{{ bus.total_seats }} seats</td>
                                                <td>
                                                    {% if bus.driver %}
                                                        {{ bus.driver.full_name }} 
                                                    {% else %}
                                                        <span class="sub-admin-badge-none">No Driver Assigned</span>
                                                    {% endif %}
                                                   
                                                </td>
                                                <td>
                                                    {% if bus.staff %}
                                                        {{ bus.staff.full_name}}
                                                    {% else %}
                                                        <span class="sub-admin-badge-none">No Staff Assigned</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    {% if bus.is_active %}
                                                        <span class="badge bg-success">Active</span>
                                                    {% else %}
                                                        <span class="badge bg-danger">Inactive</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    <div class="sub-admin-actions">
                                                        <a href="{% url 'edit_bus' bus.id %}" class="btn sub-admin-btn-edit btn-sm" title="Edit Bus">
                                                            <i class="bi bi-pencil"></i>
                                                        </a>
                                                        <a href="{% url 'delete_bus' bus.id %}" class="btn sub-admin-btn-delete btn-sm delete-bus" data-bus-name="{{ bus.bus_number }}" title="Delete Bus">
                                                            <i class="bi bi-trash"></i>
                                                        </a>
                                                    </div>
                                                </td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="7" class="sub-admin-empty">
                                                    <div class="sub-admin-empty-state">
                                                        <i class="bi bi-bus-front"></i>
                                                        <p>No buses found</p>
                                                        <a href="{% url 'create_bus' %}" class="btn sub-admin-btn-add">
                                                            <i class="bi bi-plus-circle me-2"></i>Add Your First Bus
                                                        </a>
                                                    </div>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <!-- Pagination for Buses -->
                                {% if buses.paginator.num_pages > 1 %}
                                <nav class="sub-admin-pagination mt-3">
                                    <ul class="pagination justify-content-center flex-wrap">
                                        {% if buses.has_previous %}
                                            <li class="page-item">
                                                <a class="page-link" href="?bus_page={{ buses.previous_page_number }}" aria-label="Previous">
                                                    <span aria-hidden="true">«</span>
                                                </a>
                                            </li>
                                        {% endif %}
                                        {% for num in buses.paginator.page_range %}
                                            <li class="page-item {% if buses.number == num %}active{% endif %}">
                                                <a class="page-link" href="?bus_page={{ num }}">{{ num }}</a>
                                            </li>
                                        {% endfor %}
                                        {% if buses.has_next %}
                                            <li class="page-item">
                                                <a class="page-link" href="?bus_page={{ buses.next_page_number }}" aria-label="Next">
                                                    <span aria-hidden="true">»</span>
                                                </a>
                                            </li>
                                        {% endif %}
                                    </ul>
                                </nav>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Vehicles Tab Content -->
                    <div class="tab-pane fade" id="vehicles" role="tabpanel" aria-labelledby="vehicles-tab">
                        <!-- Vehicles List Table -->
                        <div class="card sub-admin-card mb-4">
                            <div class="card-header sub-admin-card-header d-flex justify-content-between align-items-center">
                                <h6 class="m-0">
                                    <i class="bi bi-list-ul me-2"></i>All Vehicles
                                </h6>
                                <div class="input-group input-group-sm w-auto">
                                    <span class="input-group-text bg-light border-end-0"><i class="bi bi-search"></i></span>
                                    <input type="text" class="form-control border-start-0 ps-0" id="searchVehicle" placeholder="Search vehicles..." style="max-width: 200px;">
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table sub-admin-table m-0">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Vehicle Number</th>
                                                <th>Type</th>
                                                <th>Image</th>
                                                <th>Document</th>
                                                <th>Driver</th>
                                                <th>Staff</th>
                                                <th>Capacity</th>
                                                <th>Price</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for vehicle in vehicles %}
                                            <tr class="vehicle-row">
                                                <td>{{ vehicle.id }}</td>
                                                <td class="fw-medium">{{ vehicle.vechicle_number }}</td>
                                                <td>{{ vehicle.type.name }}</td>
                                                <td>
                                                    {% if vehicle.image %}
                                                        <img src="{{ vehicle.image.url }}" alt="Vehicle Image" class="img-fluid" style="max-width: 50px; max-height: 50px;">
                                                    {% else %}
                                                        <span class="sub-admin-badge-none">No Image</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    {% if vehicle.document %}
                                                        <a href="{{ vehicle.document.url }}" target="_blank" class="btn sub-admin-btn-edit btn-sm" title="View Document">
                                                            <i class="bi bi-file-earmark-text"></i>
                                                        </a>    
                                                    {% else %}
                                                        <span class="sub-admin-badge-none">No Document</span>
                                                    {% endif %}
                                                </td>

                                                <td>
                                                    {% if vehicle.driver %}
                                                        {{ vehicle.driver.full_name }} 
                                                    {% else %}
                                                        <span class="sub-admin-badge-none">No Driver Assigned</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    {% if vehicle.staff %}
                                                        {{ vehicle.staff.full_name}}
                                                    {% else %}
                                                        <span class="sub-admin-badge-none">No Staff Assigned</span>
                                                    {% endif %}
                                                </td>

                                                <td>{{ vehicle.total_seats }} seats</td>

                                                <td>Rs {{ vehicle.price }} </td>
                                                <td>
                                                    {% if vehicle.is_active %}
                                                        <span class="badge bg-success">Active</span>
                                                    {% else %}
                                                        <span class="badge bg-danger">Inactive</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    <div class="sub-admin-actions">
                                                        <a href="{% url 'vehicle_reservation_edit' vehicle.id %}" class="btn sub-admin-btn-edit btn-sm" title="Edit Vehicle">
                                                            <i class="bi bi-pencil"></i>
                                                        </a>
                                                        <a href="{% url 'delete_vehicle_reservation' vehicle.id %}" class="btn sub-admin-btn-delete btn-sm delete-vehicle" data-vehicle-name="{{ vehicle.vehicle_number }}" title="Delete Vehicle">
                                                            <i class="bi bi-trash"></i>
                                                        </a>
                                                    </div>
                                                </td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="6" class="sub-admin-empty">
                                                    <div class="sub-admin-empty-state">
                                                        <i class="bi bi-truck"></i>
                                                        <p>No vehicles found</p>
                                                        
                                                    </div>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <!-- Pagination for Vehicles -->
                                {% if vehicles.paginator.num_pages > 1 %}
                                <nav class="sub-admin-pagination mt-3">
                                    <ul class="pagination justify-content-center flex-wrap">
                                        {% if vehicles.has_previous %}
                                            <li class="page-item">
                                                <a class="page-link" href="?vehicle_page={{ vehicles.previous_page_number }}" aria-label="Previous">
                                                    <span aria-hidden="true">«</span>
                                                </a>
                                            </li>
                                        {% endif %}
                                        {% for num in vehicles.paginator.page_range %}
                                            <li class="page-item {% if vehicles.number == num %}active{% endif %}">
                                                <a class="page-link" href="?vehicle_page={{ num }}">{{ num }}</a>
                                            </li>
                                        {% endfor %}
                                        {% if vehicles.has_next %}
                                            <li class="page-item">
                                                <a class="page-link" href="?vehicle_page={{ vehicles.next_page_number }}" aria-label="Next">
                                                    <span aria-hidden="true">»</span>
                                                </a>
                                            </li>
                                        {% endif %}
                                    </ul>
                                </nav>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<style>
/* Scoped CSS for sub-admin bus list */
.sub-admin-container {
    --sa-primary: #007bff;
    --sa-primary-light: #e7f1ff;
    --sa-primary-dark: #0056b3;
    --sa-success: #28a745;
    --sa-danger: #dc3545;
    --sa-secondary: #6c757d;
}
/* General styles */
.sub-admin-title {
    color: var(--sa-primary);
    font-weight: 600;
}
.sub-admin-card {
    border: none;
    border-radius: 0.75rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    overflow: hidden;
}
.sub-admin-card-header {
    background: linear-gradient(90deg, var(--sa-primary), var(--sa-primary-dark));
    color: white;
    border-radius: 0.75rem 0.75rem 0 0;
    padding: 1rem;
}
.sub-admin-table th {
    color: var(--sa-primary);
    font-weight: 600;
    padding: 1rem;
    white-space: nowrap;
}
.sub-admin-table td {
    vertical-align: middle;
    padding: 1rem;
    white-space: nowrap;
}
/* Status badges */
.sub-admin-badge-active {
    background-color: var(--sa-success);
    color: white;
    padding: 0.375rem 0.75rem;
}
.sub-admin-badge-inactive {
    background-color: var(--sa-danger);
    color: white;
    padding: 0.375rem 0.75rem;
}
.sub-admin-badge-none {
    background-color: var(--sa-primary-light);
    color: var(--sa-primary);
    padding: 0.375rem 0.75rem;
}
/* Schedule count */
.sub-admin-schedule-count {
    background-color: var(--sa-primary-light);
    color: var(--sa-primary);
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-weight: 500;
}
/* Action buttons */
.sub-admin-actions {
    display: flex;
    gap: 0.5rem;
}
.sub-admin-btn-edit {
    color: var(--sa-primary);
    border: 1px solid var(--sa-primary);
    padding: 0.375rem 0.75rem;
    border-radius: 0.375rem;
}
.sub-admin-btn-delete {
    color: var(--sa-danger);
    border: 1px solid var(--sa-danger);
    padding: 0.375rem 0.75rem;
    border-radius: 0.375rem;
}
.sub-admin-btn-add {
    background-color: var(--sa-primary);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 0.375rem;
}
.sub-admin-btn-back {
    background-color: var(--sa-primary-light);
    color: var(--sa-primary);
    border: 1px solid var(--sa-primary);
    padding: 0.5rem;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.sub-admin-btn-add:hover, .sub-admin-btn-edit:hover, .sub-admin-btn-back:hover {
    background-color: var(--sa-primary);
    color: white;
}
.sub-admin-btn-delete:hover {
    background-color: var(--sa-danger);
    color: white;
}
/* Stats */
.sub-admin-stat-badge {
    background-color: var(--sa-primary-light);
    color: var(--sa-primary);
    padding: 0.5rem 1rem;
    border-radius: 1rem;
    font-size: 0.9rem;
}
/* Empty state */
.sub-admin-empty-state {
    text-align: center;
    padding: 3rem 1rem;
}
.sub-admin-empty-state i {
    font-size: 4rem;
    color: var(--sa-secondary);
    margin-bottom: 1rem;
}
.sub-admin-empty-state p {
    color: var(--sa-secondary);
    margin-bottom: 1.5rem;
    font-size: 1.1rem;
}
/* Pagination */
.sub-admin-pagination .page-link {
    color: var(--sa-primary);
    border-radius: 0.375rem;
    margin: 0 0.25rem;
}
.sub-admin-pagination .page-item.active .page-link {
    background-color: var(--sa-primary);
    border-color: var(--sa-primary);
    color: white;
}
/* Tab styling */
#transportationTabs .nav-link {
    color: var(--sa-secondary);
    border: none;
    border-bottom: 3px solid transparent;
    padding: 0.75rem 1.5rem;
    font-weight: 500;
}
#transportationTabs .nav-link.active {
    color: var(--sa-primary);
    border-bottom-color: var(--sa-primary);
    background-color: transparent;
}
#transportationTabs .nav-link:hover:not(.active) {
    border-bottom-color: var(--sa-secondary);
}
/* Responsive Design */
@media (max-width: 991.98px) {
    #sub-admin-page-content {
        margin-top: 20px;
    }
    .sub-admin-table {
        font-size: 0.9rem;
    }
}
@media (max-width: 767.98px) {
    .sub-admin-table {
        display: block;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    .sub-admin-stat-badge {
        font-size: 0.85rem;
        padding: 0.4rem 0.8rem;
    }
    .sub-admin-title {
        font-size: 1.5rem;
    }
    .sub-admin-actions {
        flex-direction: column;
        gap: 0.25rem;
    }
    .sub-admin-card-header {
        flex-direction: column;
        gap: 0.75rem;
        align-items: flex-start;
    }
    .sub-admin-card-header .input-group {
        width: 100%;
        max-width: none;
    }
}
@media (max-width: 575.98px) {
    .sub-admin-table td, .sub-admin-table th {
        padding: 0.75rem 0.5rem;
    }
    .sub-admin-btn-edit, .sub-admin-btn-delete {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
    }
    .sub-admin-empty-state i {
        font-size: 3rem;
    }
    .sub-admin-empty-state p {
        font-size: 1rem;
    }
    .sub-admin-btn-back {
        width: 36px;
        height: 36px;
        padding: 0.375rem;
    }
}
/* Hover effects */
.sub-admin-table tr:hover {
    background-color: var(--sa-primary-light);
    transition: background-color 0.2s ease;
}
.sub-admin-card:hover {
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    transition: box-shadow 0.2s ease;
}
</style>
{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Search functionality for buses
        const searchBus = document.getElementById('searchBus');
        if (searchBus) {
            searchBus.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const rows = document.querySelectorAll('.bus-row');
                rows.forEach(row => {
                    const busName = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                    const busType = row.querySelector('td:nth-child(3)').textContent.toLowerCase();
                    const isVisible = busName.includes(searchTerm) || busType.includes(searchTerm);
                    row.style.display = isVisible ? '' : 'none';
                });
            });
        }

        // Search functionality for vehicles
        const searchVehicle = document.getElementById('searchVehicle');
        if (searchVehicle) {
            searchVehicle.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const rows = document.querySelectorAll('.vehicle-row');
                rows.forEach(row => {
                    const vehicleName = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                    const vehicleType = row.querySelector('td:nth-child(3)').textContent.toLowerCase();
                    const isVisible = vehicleName.includes(searchTerm) || vehicleType.includes(searchTerm);
                    row.style.display = isVisible ? '' : 'none';
                });
            });
        }

        // Delete confirmation for buses
        document.querySelectorAll('.delete-bus').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const busName = this.getAttribute('data-bus-name');
                const confirmDelete = confirm(`Are you sure you want to delete the bus "${busName}"? This action cannot be undone.`);
                if (confirmDelete) {
                    window.location.href = this.href;
                }
            });
        });

        // Delete confirmation for vehicles
        document.querySelectorAll('.delete-vehicle').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const vehicleName = this.getAttribute('data-vehicle-name');
                const confirmDelete = confirm(`Are you sure you want to delete the vehicle "${vehicleName}"? This action cannot be undone.`);
                if (confirmDelete) {
                    window.location.href = this.href;
                }
            });
        });

        // Maintain tab state after page refresh
        const hash = window.location.hash;
        if (hash) {
            const tab = document.querySelector(`[data-bs-target="${hash}"]`);
            if (tab) {
                const bsTab = new bootstrap.Tab(tab);
                bsTab.show();
            }
        }

        // Enable Bootstrap tooltips
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[title]'));
        tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });
</script>
{% endblock %}
{% endblock %}